# Telegram 群管机器人菜单界面 Spec

## Why
用户希望在 Telegram 聊天界面中通过直观的按钮菜单来管理群组功能，而不是通过命令或 Web 后台。这样可以提升管理员的操作效率，让功能开关和配置更加便捷。

## What Changes
- 在 Telegram 中实现一个设置菜单界面，包含 20 个功能按钮
- 按钮分为初级、中级、高级三个层级
- 点击按钮可切换功能状态或进入详细配置
- 支持返回按钮导航

## Impact
- Affected specs: Telegram Bot API 交互、Inline Keyboard 菜单系统
- Affected code: `backend/api/telegram/webhook.ts`, 新增菜单处理逻辑

## ADDED Requirements

### Requirement: 菜单界面展示
The system SHALL provide a settings menu interface in Telegram with the following structure:

#### Scenario: 显示主菜单
- **WHEN** 管理员在群组中发送 `/settings` 或点击设置按钮
- **THEN** 机器人显示设置菜单，包含：
  - 群组名称和状态概览
  - 20 个功能按钮（分初级、中级、高级）
  - 返回按钮

### Requirement: 功能分级
The system SHALL categorize features into three levels:

**初级功能（核心必备）**：
| 功能 | 图标 | 说明 |
|------|------|------|
| 进群验证 | 😊 | 新成员入群验证 |
| 欢迎消息 | 👋 | 自动发送欢迎消息 |
| 自动回复 | ℹ️ | 关键词触发自动回复 |
| 自动删除 | 🗑️ | 按规则自动删除消息 |
| 自动封禁 | 🚫 | 违规自动封禁用户 |
| 自动警告 | ⚠️ | 违规自动警告用户 |
| 自动禁言 | 😶 | 自动禁言违规用户 |
| 刷屏处理 | 👆 | 检测并处理刷屏行为 |
| 广告封杀 | 🏛️ | 检测并处理广告消息 |
| 命令关闭 | 🚧 | 关闭/开启特定命令 |

**中级功能（增强体验）**：
| 功能 | 图标 | 说明 |
|------|------|------|
| 加密货币 | 💎 | USDT地址检测、汇率查询 |
| 群组成员 | 👥 | 成员信息管理 |
| 定时消息 | ⏰ | 定时发送群消息 |
| 积分相关 | M | 签到、积分系统 |
| 活跃度统计 | 📊 | 群聊活跃度统计 |
| 娱乐功能 | 🎮 | 小游戏、娱乐命令 |
| 实时查U价 | 💵 | 实时USDT价格查询 |
| 关联频道 | 📺 | 关联频道自动转发 |

**高级功能（管理扩展）**：
| 功能 | 图标 | 说明 |
|------|------|------|
| 管理权限 | 👮 | 设置管理员权限级别 |
| 色情检测 | 🔞 | AI检测不良内容 |
| 语言白名单 | 📝 | 限制允许的语言 |
| 邀请链接 | 🔗 | 管理邀请链接 |
| 抽奖 | 🎁 | 创建抽奖活动 |
| 认证用户 | ✅ | 认证用户特权 |

### Requirement: 按钮交互
The system SHALL handle button interactions:

#### Scenario: 切换功能状态
- **WHEN** 用户点击初级功能按钮（如"自动回复"）
- **THEN** 系统切换该功能的开启/关闭状态
- **AND** 更新菜单显示当前状态

#### Scenario: 进入详细配置
- **WHEN** 用户点击中级或高级功能按钮
- **THEN** 显示该功能的详细配置选项
- **AND** 提供返回主菜单的按钮

#### Scenario: 返回导航
- **WHEN** 用户点击"返回"按钮
- **THEN** 返回上一级菜单或关闭菜单

### Requirement: 权限控制
The system SHALL restrict menu access:

#### Scenario: 管理员验证
- **WHEN** 用户点击菜单按钮
- **THEN** 系统验证用户是否为群组管理员
- **AND** 非管理员显示"无权限"提示

## UI Layout

```
┌─────────────────────────────────────┐
│ ⚙️ 设置                              │
│ 群组：强盛集团❤️                      │
│                                      │
│ 状态：                               │
│ 入群验证 ✅已开启                     │
│ 欢迎消息 ✅已开启                     │
│                                      │
│ 选择你想改变的设置，更多帮助请访问    │
│ 群组频道                             │
├─────────────────────────────────────┤
│ 😊 进群验证    │ 👋 欢迎消息        │
│ ℹ️ 自动回复    │ 🗑️ 自动删除        │
│ 🚫 自动封禁    │ ⚠️ 自动警告        │
│ 😶 自动禁言    │ 👆 刷屏处理        │
│ 🏛️ 广告封杀    │ 🚧 命令关闭        │
├─────────────────────────────────────┤
│ 💎 加密货币    │ 👥 群组成员        │
│ ⏰ 定时消息    │ M 积分相关         │
│ 📊 活跃度统计  │ 🎮 娱乐功能        │
│ 💵 实时查U价  │ 📺 关联频道        │
├─────────────────────────────────────┤
│ 👮 管理权限    │ 🔞 色情检测        │
│ 📝 语言白名单  │ 🔗 邀请链接        │
│ 🎁 抽奖        │ ✅ 认证用户        │
├─────────────────────────────────────┤
│          🔙 返回                     │
└─────────────────────────────────────┘
```

## Technical Notes
- 使用 Telegram Inline Keyboard 实现按钮布局
- 每行最多 2 个按钮，保持界面整洁
- 按钮 callback_data 格式：`menu:{feature}:{action}`
- 需要持久化存储每个功能的开关状态
